(this["webpackJsonpreact-perspective-cropper-example"]=this["webpackJsonpreact-perspective-cropper-example"]||[]).push([[0],{142:function(e,t,n){e.exports=n(275)},143:function(e,t,n){},155:function(e,t,n){},275:function(e,t,n){"use strict";n.r(t);n(143);var r=n(0),a=n.n(r),o=n(20),i=n.n(o),c=n(39),u=n.n(c),l=n(46),s=n(47),p=n(281),m=n(54),h=n(280),d=n(284),f=n(285),b=n(92),v=n(140),g=n(35),w=n(87),E=n(6),y=n.n(E),O=n(119),x=n.n(O),j=function(e){return e instanceof File?new Promise((function(t,n){var r=new FileReader;r.onload=function(e){t(r.result)},r.onerror=function(e){n(e)},r.readAsDataURL(e)})):"string"===typeof e?Promise.resolve(e):void 0},C=function(e){var t,n,o=e.cropPoints,i=e.pointArea,c=e.defaultPosition,u=e.pointSize,l=e.pointColor,s=void 0===l?"#3cabe2":l,p=e.onStop,m=e.onDrag,h=e.bounds,d=Object(r.useCallback)((function(e,t){m(Object(g.a)(Object(g.a)({},t),{},{x:t.x+u/2,y:t.y+u/2}),i)}),[m]),f=Object(r.useCallback)((function(e,t){p(Object(g.a)(Object(g.a)({},t),{},{x:t.x+u/2,y:t.y+u/2}),i,o)}),[m,o]);return a.a.createElement(x.a,{bounds:h,defaultPosition:c,position:{x:o[i].x-u/2,y:o[i].y-u/2},onDrag:d,onStop:f},a.a.createElement("div",{style:(t=u,n=s,{width:t,height:t,backgroundColor:n,borderRadius:"100%",position:"absolute",zIndex:1001})}))};C.propTypes={cropPoints:y.a.shape({"left-top":y.a.shape({x:y.a.number,y:y.a.number}).isRequired,"right-top":y.a.shape({x:y.a.number,y:y.a.number}).isRequired,"right-bottom":y.a.shape({x:y.a.number,y:y.a.number}).isRequired,"left-bottom":y.a.shape({x:y.a.number,y:y.a.number}).isRequired}),pointArea:y.a.oneOf(["left-top","right-top","right-bottom","left-bottom"]),defaultPosition:y.a.shape({x:y.a.number,y:y.a.number}),pointSize:y.a.number,pointColor:y.a.string,onStop:y.a.func,onDrag:y.a.func};var R=function(e){var t=e.previewDims,n=Object(v.a)(e,["previewDims"]);return a.a.createElement(r.Fragment,null,a.a.createElement(C,Object.assign({pointArea:"left-top",defaultPosition:{x:0,y:0}},n)),a.a.createElement(C,Object.assign({pointArea:"right-top",defaultPosition:{x:t.width,y:0}},n)),a.a.createElement(C,Object.assign({pointArea:"right-bottom",defaultPosition:{x:0,y:t.height}},n)),a.a.createElement(C,Object.assign({pointArea:"left-bottom",defaultPosition:{x:t.width,y:t.height}},n)))};R.propTypes={previewDims:y.a.shape({ratio:y.a.number,width:y.a.number,height:y.a.number})};var S=function(e,t,n,r,a){var o,i,c=e.imread(t),u=n["right-bottom"],l=n["left-bottom"],s=n["right-top"],p=n["left-top"],m=[p,s,u,l].map((function(e){return[e.x/r,e.y/r]})),h=Math.max(u.x-l.x,s.x-p.x)/r,d=Math.max(l.y-p.y,u.y-s.y)/r,f=[[0,0],[h-1,0],[h-1,d-1],[0,d-1]],v=e.matFromArray(4,1,e.CV_32FC2,(o=[]).concat.apply(o,Object(b.a)(m))),g=e.matFromArray(4,1,e.CV_32FC2,(i=[]).concat.apply(i,f)),w=e.getPerspectiveTransform(v,g),E=new e.Size(h,d);e.warpPerspective(c,c,w,E,e.INTER_LINEAR,e.BORDER_CONSTANT,new e.Scalar),e.imshow(t,c),c.delete(),v.delete(),g.delete(),w.delete(),a()},k=function(){var e=Object(l.a)(u.a.mark((function e(t,n,r){var a,o,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Object(g.a)({blur:!1,th:!0,thMode:t.ADAPTIVE_THRESH_MEAN_C,thMeanCorrection:15,thBlockSize:25,thMax:255,grayScale:!0},r),o=t.imread(n),a.grayScale&&t.cvtColor(o,o,t.COLOR_RGBA2GRAY,0),a.blur&&(i=new t.Size(5,5),t.GaussianBlur(o,o,i,0,0,t.BORDER_DEFAULT)),a.th&&(a.grayScale?t.adaptiveThreshold(o,o,a.thMax,a.thMode,t.THRESH_BINARY,a.thBlockSize,a.thMeanCorrection):(o.convertTo(o,-1,1,60),t.threshold(o,o,170,255,t.THRESH_BINARY))),t.imshow(n,o);case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),P=function(e){var t=e.cropPoints,n=e.previewDims,o=e.lineWidth,i=void 0===o?3:o,c=e.lineColor,u=void 0===c?"#3cabe2":c,l=Object(r.useRef)(),s=Object(r.useCallback)((function(){l.current.getContext("2d").clearRect(0,0,n.width,n.height)}),[l.current,n]),p=Object(r.useCallback)((function(){return["left-top","right-top","right-bottom","left-bottom"].reduce((function(e,n){return[].concat(Object(b.a)(e),[t[n]])}),[])}),[t]),m=Object(r.useCallback)((function(e){var t=l.current.getContext("2d");t.lineWidth=i,t.strokeStyle=u,t.beginPath(),e.forEach((function(n,r){if(0===r&&t.moveTo(n.x,n.y),r!==e.length-1){var a=e[r+1];t.lineTo(a.x,a.y)}else t.closePath()})),t.stroke()}),[l.current]);return Object(r.useEffect)((function(){if(t&&l.current){s();var e=p();m(e)}}),[t,l.current]),a.a.createElement("canvas",{ref:l,style:{position:"absolute",zIndex:5,width:n.width,height:n.height},width:n.width,height:n.height})};P.propTypes={previewDims:y.a.shape({ratio:y.a.number,width:y.a.number,height:y.a.number}),cropPoints:y.a.shape({"left-top":y.a.shape({x:y.a.number,y:y.a.number}).isRequired,"right-top":y.a.shape({x:y.a.number,y:y.a.number}).isRequired,"right-bottom":y.a.shape({x:y.a.number,y:y.a.number}).isRequired,"left-bottom":y.a.shape({x:y.a.number,y:y.a.number}).isRequired}),lineColor:y.a.string,lineWidth:y.a.number};var A,T=function(e){return{width:e.width,height:e.height}},D=function(e){var t,n,o,i,c,p,m=e.image,h=e.onDragStop,d=e.onChange,f=e.cropperRef,b=e.pointSize,v=void 0===b?20:b,E=e.lineWidth,y=e.pointColor,O=e.lineColor,x=e.maxWidth,C=e.maxHeight,D=Object(w.b)(),_=D.loaded,I=D.cv,M=Object(r.useRef)(),z=Object(r.useRef)(),H=Object(r.useState)(),B=Object(s.a)(H,2),N=B[0],q=B[1],L=Object(r.useState)(),F=Object(s.a)(L,2),W=F[0],G=F[1],Y=Object(r.useState)(!1),U=Object(s.a)(Y,2),V=U[0],J=U[1],X=Object(r.useState)("crop"),K=Object(s.a)(X,2),Q=K[0],Z=K[1];Object(r.useImperativeHandle)(f,(function(){return{backToCrop:function(){Z("crop")},done:function(){var e=Object(l.a)(u.a.mark((function e(){var t,n=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.abrupt("return",new Promise((function(e){J(!0),S(I,M.current,W,A,$),k(I,M.current,t.filterCvParams),t.preview&&Z("preview"),M.current.toBlob((function(t){e(t),J(!1)}),m.type)})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}})),Object(r.useEffect)((function(){"preview"===Q&&te()}),[Q]);var $=function(){var e=function(e,t,n,r){var a=e/t,o=window.innerWidth||n,i=window.innerHeight||r,c={width:o,height:Math.round(o/a),ratio:a};return c.height>i&&(c.height=i,c.width=Math.round(i*a)),c}(M.current.width,M.current.height,x,C);q(e),z.current.width=e.width,z.current.height=e.height,A=e.width/M.current.width},ee=function(e){return new Promise((function(t,n){var r=document.createElement("img");r.onload=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:M.current=document.createElement("canvas"),M.current.width=r.width,M.current.height=r.height,M.current.getContext("2d").drawImage(r,0,0),$(),t();case 7:case"end":return e.stop()}}),e)}))),r.src=e}))},te=function(e){var t=e||I.imread(M.current),n=new I.Mat,r=new I.Size(0,0);I.resize(t,n,r,A,A,I.INTER_AREA),I.imshow(z.current,n),t.delete(),n.delete()},ne=function(){var e=I.imread(M.current),t=new I.Size(5,5);I.cvtColor(e,e,I.COLOR_RGBA2GRAY,0),I.GaussianBlur(e,e,t,0,0,I.BORDER_DEFAULT),I.Canny(e,e,75,200),I.threshold(e,e,120,200,I.THRESH_BINARY);var n=new I.MatVector,r=new I.Mat;I.findContours(e,n,r,I.RETR_CCOMP,I.CHAIN_APPROX_SIMPLE);var a=I.boundingRect(e);e.delete(),r.delete(),n.delete(),Object.keys(a).forEach((function(e){a[e]=a[e]*A}));var o={"left-top":{x:a.x,y:a.y},"right-top":{x:a.x+a.width,y:a.y},"right-bottom":{x:a.x+a.width,y:a.y+a.height},"left-bottom":{x:a.x,y:a.y+a.height}};G(o)};Object(r.useEffect)((function(){d&&d(Object(g.a)(Object(g.a)({},W),{},{loading:V}))}),[W,V]),Object(r.useEffect)((function(){var e=function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(m);case 2:return t=e.sent,e.next=5,ee(t);case 5:te(),ne(),J(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();m&&z.current&&_&&"crop"===Q?e():J(!0)}),[m,z.current,_,Q]);var re=Object(r.useCallback)((function(e,t){var n=e.x,r=e.y;G((function(e){return Object(g.a)(Object(g.a)({},e),{},{[t]:{x:n,y:r}})}))}),[]),ae=Object(r.useCallback)((function(e,t,n){var r=e.x,a=e.y;G((function(e){return Object(g.a)(Object(g.a)({},e),{},{[t]:{x:r,y:a}})})),h&&h(Object(g.a)(Object(g.a)({},n),{},{[t]:{x:r,y:a}}))}),[]);return a.a.createElement("div",{style:Object(g.a)({position:"relative"},N&&T(N))},N&&"crop"===Q&&W&&a.a.createElement(R,{pointSize:v,pointColor:y,cropPoints:W,previewDims:N,onDrag:re,onStop:ae,bounds:{left:(null===z||void 0===z||null===(t=z.current)||void 0===t?void 0:t.offsetLeft)-v/2,top:(null===z||void 0===z||null===(n=z.current)||void 0===n?void 0:n.offsetTop)-v/2,right:(null===z||void 0===z||null===(o=z.current)||void 0===o?void 0:o.offsetLeft)-v/2+(null===z||void 0===z||null===(i=z.current)||void 0===i?void 0:i.offsetWidth),bottom:(null===z||void 0===z||null===(c=z.current)||void 0===c?void 0:c.offsetTop)-v/2+(null===z||void 0===z||null===(p=z.current)||void 0===p?void 0:p.offsetHeight)}}),N&&"crop"===Q&&W&&a.a.createElement(P,{previewDims:N,cropPoints:W,lineWidth:E,lineColor:O}),a.a.createElement("canvas",{style:{zIndex:5,pointerEvents:"none"},ref:z}))};D.propTypes={image:y.a.object.isRequired,onDragStop:y.a.func,onChange:y.a.func,cropperRef:y.a.shape({current:y.a.shape({done:y.a.func.isRequired,backToCrop:y.a.func.isRequired})}),pointSize:y.a.number,lineWidth:y.a.number,pointColor:y.a.string,lineColor:y.a.string};var _=a.a.forwardRef((function(e,t){return e.image?a.a.createElement(w.a,{openCvPath:e.openCvPath},a.a.createElement(D,Object.assign({},e,{cropperRef:t}))):null}));_.propTypes={openCvPath:y.a.string};var I=_,M=(n(155),n(282)),z=n(283),H=n(91),B=n.n(H),N=function(){return a.a.createElement("div",{className:"site-page-header"},a.a.createElement(M.a,{ghost:!1,title:"react-perspective-cropper"},a.a.createElement(z.b,{size:"small",column:2},a.a.createElement(z.b.Item,{label:"Package"},a.a.createElement("a",{href:"https://www.npmjs.com/package/react-perspective-cropper"},a.a.createElement("img",{alt:"npm",src:"https://img.shields.io/npm/v/react-perspective-cropper.svg"})),a.a.createElement("a",{href:"https://standardjs.com"},a.a.createElement("img",{alt:"standardjs",src:"https://img.shields.io/badge/code_style-standard-brightgreen.svg"}))),a.a.createElement(z.b.Item,{label:"Description"},a.a.createElement(B.a,null,"React component performing border detection, perspective correction and simple image filters over a provided image \ud83d\udcf2 \ud83d\udcf8")),a.a.createElement(z.b.Item,{label:"Created by"},"Giacomo Cerquone from",a.a.createElement("span",{"aria-label":"italy flag",role:"img",style:{margin:"0 10px"}},"\ud83c\uddee\ud83c\uddf9"),"with"," ",a.a.createElement("span",{"aria-label":"heart",role:"img",style:{margin:"0 10px"}},"\u2764\ufe0f")),a.a.createElement(z.b.Item,{label:"Info"},a.a.createElement(B.a,null,"Make sure to only use HiRes images!",a.a.createElement("br",null),a.a.createElement("b",null,a.a.createElement("a",{rel:"noreferrer",target:"_blank",href:"https://github.com/giacomocerquone/react-perspective-cropper/blob/master/gifs/example-img.jpg?raw=true"},"You could use this image for example.")))))))},q=p.a.Dragger,L=function(){var e=Object(r.useState)(),t=Object(s.a)(e,2),n=t[0],o=t[1],i=Object(r.useState)(),c=Object(s.a)(i,2),p=c[0],b=c[1],v=Object(r.useRef)(),g=Object(r.useCallback)((function(e){return o(e)}),[]),w=Object(r.useCallback)((function(e){return o(e)}),[]),E=function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("CropState",n),e.prev=1,e.next=4,v.current.done({preview:!0,filterCvParams:{thMeanCorrection:13,thMode:window.cv.ADAPTIVE_THRESH_GAUSSIAN_C}});case 4:t=e.sent,console.log("Cropped and filtered image",t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log("error",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),y={name:"file",multiple:!1,onChange:function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.fileList&&t.fileList.length>0&&b(t.fileList[0].originFileObj);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};return a.a.createElement("div",{className:"root-container"},a.a.createElement(N,null),a.a.createElement("div",{className:"content-container"},n&&a.a.createElement("div",{className:"buttons-container"},a.a.createElement(m.a,{onClick:E,icon:a.a.createElement(d.a,null)},"Done"),a.a.createElement(m.a,{onClick:function(){v.current.backToCrop()}},"Back"),a.a.createElement(m.a,{onClick:function(){b(void 0),o()}},"Reset")),a.a.createElement(I,{openCvPath:"./opencv/opencv.js",ref:v,image:p,onChange:w,onDragStop:g}),(null===n||void 0===n?void 0:n.loading)&&a.a.createElement(h.a,null),!p&&a.a.createElement(q,y,a.a.createElement("p",null,a.a.createElement(f.a,null)),a.a.createElement("p",null,"Upload"))))};i.a.render(a.a.createElement(L,null),document.getElementById("root"))}},[[142,1,2]]]);
//# sourceMappingURL=main.8c2e77c2.chunk.js.map