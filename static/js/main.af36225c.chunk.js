(this["webpackJsonpreact-perspective-cropper-example"]=this["webpackJsonpreact-perspective-cropper-example"]||[]).push([[0],{137:function(e,t,r){e.exports=r(270)},138:function(e,t,r){},150:function(e,t,r){},270:function(e,t,r){"use strict";r.r(t);r(138);var n=r(0),a=r.n(n),o=r(20),i=r.n(o),c=r(62),l=r.n(c),u=r(82),s=r(87),p=r(276),h=r(50),m=r(275),d=r(279),f=r(280),b=r(83),g=r(6),v=r.n(g),y=r(114),w=r.n(y);function E(){return(E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function C(){var e=Object(n.useState)(),t=e[0],r=e[1];return[t,Object(n.useCallback)((function(e){r(e)}),[])]}var x=function(e){var t,r,o=e.cropPoints,i=e.pointArea,c=e.defaultPosition,l=e.pointSize,u=void 0===l?20:l,s=e.pointColor,p=void 0===s?"#3cabe2":s,h=e.onStop,m=e.onDrag,d=Object(n.useCallback)((function(e,t){m(E({},t,{x:t.x+u/2,y:t.y+u/2}),i)}),[m]),f=Object(n.useCallback)((function(e,t){h(E({},t,{x:t.x+u/2,y:t.y+u/2}),i,o)}),[m,o]);return a.a.createElement(w.a,{bounds:"parent",defaultPosition:c,position:{x:o[i].x-u/2,y:o[i].y-u/2},onDrag:d,onStop:f},a.a.createElement("div",{style:(t=u,r=p,{width:t,height:t,backgroundColor:r,borderRadius:"100%",position:"absolute",zIndex:1001})}))};x.propTypes={cropPoints:v.a.shape({"left-top":v.a.shape({x:v.a.number,y:v.a.number}).isRequired,"right-top":v.a.shape({x:v.a.number,y:v.a.number}).isRequired,"right-bottom":v.a.shape({x:v.a.number,y:v.a.number}).isRequired,"left-bottom":v.a.shape({x:v.a.number,y:v.a.number}).isRequired}),pointArea:v.a.oneOf(["left-top","right-top","right-bottom","left-bottom"]),defaultPosition:v.a.shape({x:v.a.number,y:v.a.number}),pointSize:v.a.number,pointColor:v.a.string,onStop:v.a.func,onDrag:v.a.func};var R=function(e){var t=e.previewDims,r=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,["previewDims"]);return a.a.createElement(n.Fragment,null,a.a.createElement(x,E({pointArea:"left-top",defaultPosition:{x:0,y:0}},r)),a.a.createElement(x,E({pointArea:"right-top",defaultPosition:{x:t.width,y:0}},r)),a.a.createElement(x,E({pointArea:"right-bottom",defaultPosition:{x:0,y:t.height}},r)),a.a.createElement(x,E({pointArea:"left-bottom",defaultPosition:{x:t.width,y:t.height}},r)))};R.propTypes={previewDims:v.a.shape({ratio:v.a.number,width:v.a.number,height:v.a.number})};var O=function(e){var t=e.cropPoints,r=e.previewDims,o=e.lineWidth,i=void 0===o?3:o,c=e.lineColor,l=void 0===c?"#3cabe2":c,u=C(),s=u[0],p=u[1],h=Object(n.useCallback)((function(){s.getContext("2d").clearRect(0,0,r.width,r.height)}),[s,r]),m=Object(n.useCallback)((function(){return["left-top","right-top","right-bottom","left-bottom"].reduce((function(e,r){return[].concat(e,[t[r]])}),[])}),[t]),d=Object(n.useCallback)((function(e){var t=s.getContext("2d");t.lineWidth=i,t.strokeStyle=l,t.beginPath(),e.forEach((function(r,n){if(0===n&&t.moveTo(r.x,r.y),n!==e.length-1){var a=e[n+1];t.lineTo(a.x,a.y)}else t.closePath()})),t.stroke()}),[s]);return Object(n.useEffect)((function(){if(t&&s){h();var e=m();d(e)}}),[t,s]),a.a.createElement("canvas",{ref:p,style:{position:"absolute",zIndex:5,width:r.width,height:r.height},width:r.width,height:r.height})};O.propTypes={previewDims:v.a.shape({ratio:v.a.number,width:v.a.number,height:v.a.number}),cropPoints:v.a.shape({"left-top":v.a.shape({x:v.a.number,y:v.a.number}).isRequired,"right-top":v.a.shape({x:v.a.number,y:v.a.number}).isRequired,"right-bottom":v.a.shape({x:v.a.number,y:v.a.number}).isRequired,"left-bottom":v.a.shape({x:v.a.number,y:v.a.number}).isRequired}),lineColor:v.a.string,lineWidth:v.a.number};var j,P=function(e){return{width:e.width,height:e.height}},S={width:0,height:0},k=function(e){var t=e.image,r=e.onDragStop,o=e.onChange,i=e.cropperRef,c=e.pointSize,l=e.lineWidth,u=e.pointColor,s=e.lineColor,p=Object(b.b)(),h=p.loaded,m=p.cv,d=Object(n.useRef)(),f=C(),g=f[0],v=f[1],y=Object(n.useState)(),w=y[0],x=y[1],k=Object(n.useState)(),A=k[0],T=k[1],D=Object(n.useState)(!1),_=D[0],I=D[1],M=Object(n.useState)("crop"),z=M[0],B=M[1];Object(n.useImperativeHandle)(i,(function(){return{backToCrop:function(){B("crop")},done:function(e){void 0===e&&(e={});try{return Promise.resolve(new Promise((function(r){I(!0),function(e,t,r,n,a){var o,i,c=e.imread(t),l=r["right-bottom"],u=r["left-bottom"],s=r["right-top"],p=r["left-top"],h=[p,s,l,u].map((function(e){return[e.x/n,e.y/n]})),m=Math.max(l.x-u.x,s.x-p.x)/n,d=Math.max(u.y-p.y,l.y-s.y)/n,f=[[0,0],[m-1,0],[m-1,d-1],[0,d-1]],b=e.matFromArray(4,1,e.CV_32FC2,(o=[]).concat.apply(o,h)),g=e.matFromArray(4,1,e.CV_32FC2,(i=[]).concat.apply(i,f)),v=e.getPerspectiveTransform(b,g),y=new e.Size(m,d);e.warpPerspective(c,c,v,y,e.INTER_LINEAR,e.BORDER_CONSTANT,new e.Scalar),e.imshow(t,c),c.delete(),b.delete(),g.delete(),v.delete(),a()}(m,d.current,A,j,N),function(e,t,r){try{var n=E({blur:!1,th:!0,thMode:e.ADAPTIVE_THRESH_MEAN_C,thMeanCorrection:15,thBlockSize:25,thMax:255,grayScale:!0},r),a=e.imread(t);if(n.grayScale&&e.cvtColor(a,a,e.COLOR_RGBA2GRAY,0),n.blur){var o=new e.Size(5,5);e.GaussianBlur(a,a,o,0,0,e.BORDER_DEFAULT)}n.th&&(n.grayScale?e.adaptiveThreshold(a,a,n.thMax,n.thMode,e.THRESH_BINARY,n.thBlockSize,n.thMeanCorrection):(a.convertTo(a,-1,1,60),e.threshold(a,a,170,255,e.THRESH_BINARY))),e.imshow(t,a),Promise.resolve()}catch(i){return Promise.reject(i)}}(m,d.current,e.filterCvParams),e.preview&&B("preview"),d.current.toBlob((function(e){r(e),I(!1)}),t.type)})))}catch(r){return Promise.reject(r)}}}})),Object(n.useEffect)((function(){"preview"===z&&H()}),[z]);var N=function(){var e=function(e,t){var r=e/t,n=window.innerWidth-40,a=window.innerHeight-240,o={width:n,height:Math.round(n/r),ratio:r};return o.height>a&&(o.height=a,o.width=Math.round(a*r)),o}(d.current.width,d.current.height);x(e),g.width=e.width,g.height=e.height,j=e.width/d.current.width},H=function(e){var t=e||m.imread(d.current),r=new m.Mat,n=new m.Size(0,0);m.resize(t,r,n,j,j,m.INTER_AREA),m.imshow(g,r),t.delete(),r.delete()};Object(n.useEffect)((function(){o&&o(E({},A,{loading:_}))}),[A,_]),Object(n.useEffect)((function(){t&&g&&h&&"crop"===z?function(){try{return Promise.resolve((e=t,e instanceof File?new Promise((function(t,r){var n=new FileReader;n.onload=function(e){t(n.result)},n.onerror=function(e){r(e)},n.readAsDataURL(e)})):"string"===typeof e?Promise.resolve(e):void 0)).then((function(e){return Promise.resolve(function(e){return new Promise((function(t,r){var n=document.createElement("img");n.onload=function(){try{return d.current=document.createElement("canvas"),d.current.width=n.width,d.current.height=n.height,d.current.getContext("2d").drawImage(n,0,0),S.width=d.current.width,S.height=d.current.height,N(),t(),Promise.resolve()}catch(e){return Promise.reject(e)}},n.src=e}))}(e)).then((function(){H(),function(){var e=m.imread(d.current),t=new m.Size(5,5);m.cvtColor(e,e,m.COLOR_RGBA2GRAY,0),m.GaussianBlur(e,e,t,0,0,m.BORDER_DEFAULT),m.Canny(e,e,75,200),m.threshold(e,e,120,200,m.THRESH_BINARY);var r=new m.MatVector,n=new m.Mat;m.findContours(e,r,n,m.RETR_CCOMP,m.CHAIN_APPROX_SIMPLE);var a=m.boundingRect(e);e.delete(),n.delete(),r.delete(),Object.keys(a).forEach((function(e){a[e]=a[e]*j}));var o={"left-top":{x:a.x,y:a.y},"right-top":{x:a.x+a.width,y:a.y},"right-bottom":{x:a.x+a.width,y:a.y+a.height},"left-bottom":{x:a.x,y:a.y+a.height}};T(o)}(),I(!1)}))}))}catch(r){return Promise.reject(r)}var e}():I(!0)}),[t,g,h,z]);var q=Object(n.useCallback)((function(e,t){var r=e.x,n=e.y;T((function(e){var a;return E({},e,((a={})[t]={x:r,y:n},a))}))}),[]),F=Object(n.useCallback)((function(e,t,n){var a,o=e.x,i=e.y;(T((function(e){var r;return E({},e,((r={})[t]={x:o,y:i},r))})),r)&&r(E({},n,((a={})[t]={x:o,y:i},a)))}),[]);return a.a.createElement("div",{style:E({position:"relative"},w&&P(w))},w&&"crop"===z&&A&&a.a.createElement(R,{pointSize:c,pointColor:u,cropPoints:A,previewDims:w,onDrag:q,onStop:F}),w&&"crop"===z&&A&&a.a.createElement(O,{previewDims:w,cropPoints:A,lineWidth:l,lineColor:s}),a.a.createElement("canvas",{style:{zIndex:5,pointerEvents:"none"},ref:v}))};k.propTypes={image:v.a.object.isRequired,onDragStop:v.a.func,onChange:v.a.func,cropperRef:v.a.shape({current:v.a.shape({done:v.a.func.isRequired,backToCrop:v.a.func.isRequired})}),pointSize:v.a.number,lineWidth:v.a.number,pointColor:v.a.string,lineColor:v.a.string};var A=a.a.forwardRef((function(e,t){return e.image?a.a.createElement(b.a,{openCvPath:"/opencv/opencv.js"},a.a.createElement(k,E({},e,{cropperRef:t}))):null})),T=(r(150),r(277)),D=r(278),_=r(124),I=r.n(_),M=function(){return a.a.createElement("div",{className:"site-page-header"},a.a.createElement(T.a,{ghost:!1,title:"react-perspective-cropper"},a.a.createElement(D.b,{size:"small",column:2},a.a.createElement(D.b.Item,{label:"Package"},a.a.createElement("a",{href:"https://www.npmjs.com/package/react-perspective-cropper"},a.a.createElement("img",{alt:"npm",src:"https://img.shields.io/npm/v/react-perspective-cropper.svg"})),a.a.createElement("a",{href:"https://standardjs.com"},a.a.createElement("img",{alt:"standardjs",src:"https://img.shields.io/badge/code_style-standard-brightgreen.svg"}))),a.a.createElement(D.b.Item,{label:"Description"},a.a.createElement(I.a,null,"React component performing border detection, perspective correction and simple image filters over a provided image \ud83d\udcf2 \ud83d\udcf8")),a.a.createElement(D.b.Item,{label:"Created by"},"Giacomo Cerquone from",a.a.createElement("span",{"aria-label":"italy flag",role:"img",style:{margin:"0 10px"}},"\ud83c\uddee\ud83c\uddf9"),"with"," ",a.a.createElement("span",{"aria-label":"heart",role:"img",style:{margin:"0 10px"}},"\u2764\ufe0f")))))},z=p.a.Dragger,B=function(){var e=Object(n.useState)(),t=Object(s.a)(e,2),r=t[0],o=t[1],i=Object(n.useState)(),c=Object(s.a)(i,2),p=c[0],b=c[1],g=Object(n.useRef)(),v=Object(n.useCallback)((function(e){return o(e)}),[]),y=Object(n.useCallback)((function(e){return o(e)}),[]),w=function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("CropState",r),e.prev=1,e.next=4,g.current.done({preview:!0,filterCvParams:{thMeanCorrection:13,thMode:window.cv.ADAPTIVE_THRESH_GAUSSIAN_C}});case 4:t=e.sent,console.log("Cropped and filtered image",t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log("error",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),E={name:"file",multiple:!1,onChange:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.fileList&&t.fileList.length>0&&b(t.fileList[0].originFileObj);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};return a.a.createElement("div",{className:"root-container"},a.a.createElement(M,null),a.a.createElement("div",{className:"content-container"},r&&a.a.createElement("div",{className:"buttons-container"},a.a.createElement(h.a,{onClick:w,icon:a.a.createElement(d.a,null)},"Done"),a.a.createElement(h.a,{onClick:function(){g.current.backToCrop()}},"Back"),a.a.createElement(h.a,{onClick:function(){b(void 0),o()}},"Reset")),a.a.createElement(A,{ref:g,image:p,onChange:y,onDragStop:v}),(null===r||void 0===r?void 0:r.loading)&&a.a.createElement(m.a,null),!p&&a.a.createElement(z,E,a.a.createElement("p",null,a.a.createElement(f.a,null)),a.a.createElement("p",null,"Upload"))))};i.a.render(a.a.createElement(B,null),document.getElementById("root"))}},[[137,1,2]]]);
//# sourceMappingURL=main.af36225c.chunk.js.map