(this["webpackJsonpreact-perspective-cropper-example"]=this["webpackJsonpreact-perspective-cropper-example"]||[]).push([[0],{132:function(e,t,n){e.exports=n(258)},133:function(e,t,n){},145:function(e,t,n){},258:function(e,t,n){"use strict";n.r(t);n(133);var r=n(0),a=n.n(r),o=n(19),i=n.n(o),c=n(61),l=n.n(c),u=n(82),s=n(72),h=n(262),m=n(49),p=n(266),f=n(267),d=n(83),v=n(110),g=n.n(v);function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function E(){var e=Object(r.useState)(),t=e[0],n=e[1];return[t,Object(r.useCallback)((function(e){n(e)}),[])]}var w,y={width:15,height:15,backgroundColor:"#3cabe2",borderRadius:"100%",position:"absolute",zIndex:1001},O=function(e){var t=e.cropPoints,n=e.pointArea,o=e.defaultPosition,i=e.onStop,c=e.onDrag,l=Object(r.useCallback)((function(e,t){c(t,n)}),[c]),u=Object(r.useCallback)((function(e,r){i(r,n,t)}),[c,t]);return a.a.createElement(g.a,{bounds:"parent",defaultPosition:o,position:t[n],onDrag:l,onStop:u},a.a.createElement("div",{style:y}))},j=function(e){var t=e.previewDims,n=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,["previewDims"]);return a.a.createElement(r.Fragment,null,a.a.createElement(O,b({pointArea:"left-top",defaultPosition:{x:0,y:0}},n)),a.a.createElement(O,b({pointArea:"right-top",defaultPosition:{x:t.width,y:0}},n)),a.a.createElement(O,b({pointArea:"right-bottom",defaultPosition:{x:0,y:t.height}},n)),a.a.createElement(O,b({pointArea:"left-bottom",defaultPosition:{x:t.width,y:t.height}},n)))},x=function(e){var t=e.cropPoints,n=e.previewDims,o=E(),i=o[0],c=o[1],l=Object(r.useCallback)((function(){i.getContext("2d").clearRect(0,0,n.width,n.height)}),[i,n]),u=Object(r.useCallback)((function(){return["left-top","right-top","right-bottom","left-bottom"].reduce((function(e,n){return[].concat(e,[t[n]])}),[])}),[t]),s=Object(r.useCallback)((function(e){var t=i.getContext("2d");t.lineWidth=3,t.strokeStyle="#3cabe2",t.beginPath(),e.forEach((function(n,r){if(0===r&&t.moveTo(n.x,n.y),r!==e.length-1){var a=e[r+1];t.lineTo(a.x,a.y)}else t.closePath()})),t.stroke()}),[i]);return Object(r.useEffect)((function(){if(Object.keys(t).length&&i){l();var e=u();s(e)}}),[t,i]),a.a.createElement("canvas",{ref:c,style:{position:"absolute",zIndex:5,width:n.width,height:n.height},width:n.width,height:n.height})},C=function(e){return{width:e.width,height:e.height}},R={width:0,height:0},P=function(e){var t=e.image,n=e.onDragStop,o=e.onChange,i=e.cropperRef,c=Object(d.b)(),l=c.loaded,u=c.cv,s=Object(r.useRef)(),h=E(),m=h[0],p=h[1],f=Object(r.useState)(),v=f[0],g=f[1],y=Object(r.useState)({}),O=y[0],P=y[1],k=Object(r.useState)(!1)[1],S=Object(r.useState)("crop"),A=S[0],D=S[1];Object(r.useImperativeHandle)(i,(function(){return{backToCrop:function(){D("crop")},done:function(e){void 0===e&&(e={});try{return Promise.resolve(new Promise((function(n){k(!0),function(e,t,n,r,a){var o,i,c=e.imread(t),l=n["right-bottom"],u=n["left-bottom"],s=n["right-top"],h=n["left-top"],m=[h,s,l,u].map((function(e){return[e.x/r,e.y/r]})),p=Math.max(l.x-u.x,s.x-h.x)/r,f=Math.max(u.y-h.y,l.y-s.y)/r,d=[[0,0],[p-1,0],[p-1,f-1],[0,f-1]],v=e.matFromArray(4,1,e.CV_32FC2,(o=[]).concat.apply(o,m)),g=e.matFromArray(4,1,e.CV_32FC2,(i=[]).concat.apply(i,d)),b=e.getPerspectiveTransform(v,g),E=new e.Size(p,f);e.warpPerspective(c,c,b,E,e.INTER_LINEAR,e.BORDER_CONSTANT,new e.Scalar),e.imshow(t,c),c.delete(),v.delete(),g.delete(),b.delete(),a()}(u,s.current,O,w,T),function(e,t){try{var n={blur:!1,th:!0,thMode:e.ADAPTIVE_THRESH_MEAN_C,thMeanCorrection:15,thBlockSize:25,thMax:255,grayScale:!0},r=e.imread(t);if(n.grayScale&&e.cvtColor(r,r,e.COLOR_RGBA2GRAY,0),n.blur){var a=new e.Size(5,5);e.GaussianBlur(r,r,a,0,0,e.BORDER_DEFAULT)}n.th&&(n.grayScale?e.adaptiveThreshold(r,r,n.thMax,n.thMode,e.THRESH_BINARY,5,8):(r.convertTo(r,-1,1,60),e.threshold(r,r,170,255,e.THRESH_BINARY))),e.imshow(t,r),Promise.resolve()}catch(o){return Promise.reject(o)}}(u,s.current),e.preview&&D("preview"),s.current.toBlob((function(e){n(e),k(!1)}),t.type)})))}catch(n){return Promise.reject(n)}}}})),Object(r.useEffect)((function(){"preview"===A&&_()}),[A]);var T=function(){var e=function(e,t){var n=e/t,r=window.innerWidth-40,a=window.innerHeight-240,o={width:r,height:Math.round(r/n),ratio:n};return o.height>a&&(o.height=a,o.width=Math.round(a*n)),o}(s.current.width,s.current.height);g(e),m.width=e.width,m.height=e.height,w=e.width/s.current.width},_=function(e){var t=e||u.imread(s.current),n=new u.Mat,r=new u.Size(0,0);u.resize(t,n,r,w,w,u.INTER_AREA),u.imshow(m,n),t.delete(),n.delete()};Object(r.useEffect)((function(){o&&o(O)}),[O]),Object(r.useEffect)((function(){t&&m&&l&&"crop"===A&&function(){try{return Promise.resolve((e=t,e instanceof File?new Promise((function(t,n){var r=new FileReader;r.onload=function(e){t(r.result)},r.onerror=function(e){n(e)},r.readAsDataURL(e)})):"string"===typeof e?Promise.resolve(e):void 0)).then((function(e){return Promise.resolve(function(e){return new Promise((function(t,n){var r=document.createElement("img");r.onload=function(){try{return s.current=document.createElement("canvas"),s.current.width=r.width,s.current.height=r.height,s.current.getContext("2d").drawImage(r,0,0),R.width=s.current.width,R.height=s.current.height,T(),t(),Promise.resolve()}catch(e){return Promise.reject(e)}},r.src=e}))}(e)).then((function(){_(),function(){var e=u.imread(s.current),t=new u.Size(5,5);u.cvtColor(e,e,u.COLOR_RGBA2GRAY,0),u.GaussianBlur(e,e,t,0,0,u.BORDER_DEFAULT),u.Canny(e,e,75,200),u.threshold(e,e,120,200,u.THRESH_BINARY);var n=new u.MatVector,r=new u.Mat;u.findContours(e,n,r,u.RETR_CCOMP,u.CHAIN_APPROX_SIMPLE);var a=u.boundingRect(e);e.delete(),r.delete(),n.delete(),Object.keys(a).forEach((function(e){a[e]=a[e]*w}));var o={"left-top":{x:a.x,y:a.y},"right-top":{x:a.x+a.width,y:a.y},"right-bottom":{x:a.x+a.width,y:a.y+a.height},"left-bottom":{x:a.x,y:a.y+a.height}};P(o)}()}))}))}catch(n){return Promise.reject(n)}var e}()}),[t,m,l,A]);var I=Object(r.useCallback)((function(e,t){var n=e.x,r=e.y;P((function(e){var a;return b({},e,((a={})[t]={x:n,y:r},a))}))}),[]),M=Object(r.useCallback)((function(e,t,r){var a,o=e.x,i=e.y;(P((function(e){var n;return b({},e,((n={})[t]={x:o,y:i},n))})),n)&&n(b({},r,((a={})[t]={x:o,y:i},a)))}),[]);return a.a.createElement("div",{style:b({position:"relative"},v&&C(v))},v&&"crop"===A&&a.a.createElement(j,{cropPoints:O,previewDims:v,onDrag:I,onStop:M}),v&&a.a.createElement(x,{previewDims:v,cropPoints:O,imageResizeRatio:w}),a.a.createElement("canvas",{style:{zIndex:5,pointerEvents:"none"},ref:p}))},k=a.a.forwardRef((function(e,t){return e.image?a.a.createElement(d.a,{openCvPath:"/opencv/opencv.js"},a.a.createElement(P,b({},e,{cropperRef:t}))):null})),S=(n(145),n(263)),A=n(265),D=n(120),T=n.n(D),_=function(){return a.a.createElement("div",{className:"site-page-header"},a.a.createElement(S.a,{ghost:!1,title:"react-perspective-cropper"},a.a.createElement(A.b,{size:"small",column:2},a.a.createElement(A.b.Item,{label:"Package"},a.a.createElement("a",{href:"https://www.npmjs.com/package/react-perspective-cropper"},a.a.createElement("img",{alt:"npm",src:"https://img.shields.io/npm/v/react-perspective-cropper.svg"})),a.a.createElement("a",{href:"https://standardjs.com"},a.a.createElement("img",{alt:"standardjs",src:"https://img.shields.io/badge/code_style-standard-brightgreen.svg"}))),a.a.createElement(A.b.Item,{label:"Description"},a.a.createElement(T.a,null,"React component performing border detection, perspective correction and simple image filters over a provided image \ud83d\udcf2 \ud83d\udcf8")),a.a.createElement(A.b.Item,{label:"Created by"},"Giacomo Cerquone from",a.a.createElement("span",{"aria-label":"italy flag",role:"img",style:{margin:"0 10px"}},"\ud83c\uddee\ud83c\uddf9"),"with"," ",a.a.createElement("span",{"aria-label":"heart",role:"img",style:{margin:"0 10px"}},"\u2764\ufe0f")))))},I=h.a.Dragger,M=function(){var e=Object(r.useState)(),t=Object(s.a)(e,2),n=t[0],o=t[1],i=Object(r.useState)(),c=Object(s.a)(i,2),h=c[0],d=c[1],v=Object(r.useState)(0),g=Object(s.a)(v,2),b=(g[0],g[1]),E=Object(r.useRef)(),w=Object(r.useCallback)((function(e){return o(e)}),[]),y=Object(r.useCallback)((function(e){return o(e)}),[]),O=function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(n),e.prev=1,e.next=4,E.current.done({preview:!0});case 4:t=e.sent,console.log(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log("error",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),j={name:"file",multiple:!1,onChange:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(t),t.fileList&&t.fileList.length>0&&d(t.fileList[0].originFileObj);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};return a.a.createElement("div",{className:"root-container"},a.a.createElement(_,null),a.a.createElement("div",{className:"content-container"},(null===E||void 0===E?void 0:E.current)&&h&&a.a.createElement("div",{className:"buttons-container"},a.a.createElement(m.a,{onClick:O,icon:a.a.createElement(p.a,null)},"Done"),a.a.createElement(m.a,{onClick:function(){E.current.backToCrop()}},"Back"),a.a.createElement(m.a,{onClick:function(){d(void 0),b((function(e){return e+1}))}},"Reset")),a.a.createElement(k,{ref:E,image:h,onChange:y,onDragStop:w}),!h&&a.a.createElement(I,j,a.a.createElement("p",null,a.a.createElement(f.a,null)),a.a.createElement("p",null,"Upload"))))};i.a.render(a.a.createElement(M,null),document.getElementById("root"))}},[[132,1,2]]]);
//# sourceMappingURL=main.3988d60e.chunk.js.map