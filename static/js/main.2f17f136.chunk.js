(this["webpackJsonpreact-perspective-cropper-example"]=this["webpackJsonpreact-perspective-cropper-example"]||[]).push([[0],{137:function(e,t,r){e.exports=r(270)},138:function(e,t,r){},150:function(e,t,r){},270:function(e,t,r){"use strict";r.r(t);r(138);var n=r(0),a=r.n(n),o=r(20),i=r.n(o),c=r(62),l=r.n(c),u=r(82),s=r(88),p=r(276),m=r(50),h=r(275),d=r(279),f=r(280),v=r(83),b=r(6),g=r.n(b),y=r(115),E=r.n(y);function w(){return(w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var x=function(e,t,r){return{width:e,height:e,backgroundColor:t,border:r,borderRadius:"100%",position:"absolute",zIndex:1001}},C=function(e){var t=e.cropPoints,r=e.pointArea,o=e.defaultPosition,i=e.pointSize,c=e.pointBgColor,l=void 0===c?"transparent":c,u=e.pointBorder,s=void 0===u?"4px solid #3cabe2":u,p=e.onStop,m=e.onDrag,h=e.bounds,d=Object(n.useCallback)((function(e,t){m(w({},t,{x:t.x+i/2,y:t.y+i/2}),r)}),[m]),f=Object(n.useCallback)((function(e,n){p(w({},n,{x:n.x+i/2,y:n.y+i/2}),r,t)}),[m,t]);return a.a.createElement(E.a,{bounds:h,defaultPosition:o,position:{x:t[r].x-i/2,y:t[r].y-i/2},onDrag:d,onStop:f},a.a.createElement("div",{style:x(i,l,s)}))};C.propTypes={cropPoints:g.a.shape({"left-top":g.a.shape({x:g.a.number,y:g.a.number}).isRequired,"right-top":g.a.shape({x:g.a.number,y:g.a.number}).isRequired,"right-bottom":g.a.shape({x:g.a.number,y:g.a.number}).isRequired,"left-bottom":g.a.shape({x:g.a.number,y:g.a.number}).isRequired}),pointArea:g.a.oneOf(["left-top","right-top","right-bottom","left-bottom"]),defaultPosition:g.a.shape({x:g.a.number,y:g.a.number}),pointSize:g.a.number,pointBgColor:g.a.string,pointBorder:g.a.string,onStop:g.a.func,onDrag:g.a.func};var R=function(e){var t=e.previewDims,r=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,["previewDims"]);return a.a.createElement(n.Fragment,null,a.a.createElement(C,w({pointArea:"left-top",defaultPosition:{x:0,y:0}},r)),a.a.createElement(C,w({pointArea:"right-top",defaultPosition:{x:t.width,y:0}},r)),a.a.createElement(C,w({pointArea:"right-bottom",defaultPosition:{x:0,y:t.height}},r)),a.a.createElement(C,w({pointArea:"left-bottom",defaultPosition:{x:t.width,y:t.height}},r)))};R.propTypes={previewDims:g.a.shape({ratio:g.a.number,width:g.a.number,height:g.a.number})};var O=function(e){var t=e.cropPoints,r=e.previewDims,o=e.lineWidth,i=void 0===o?3:o,c=e.lineColor,l=void 0===c?"#3cabe2":c,u=e.pointSize,s=Object(n.useRef)(),p=Object(n.useCallback)((function(){s.current.getContext("2d").clearRect(0,0,r.width,r.height)}),[s.current,r]),m=Object(n.useCallback)((function(){return["left-top","right-top","right-bottom","left-bottom"].reduce((function(e,r){return[].concat(e,[t[r]])}),[])}),[t]),h=Object(n.useCallback)((function(e){var t=e[0],r=e[1],n=e[2],a=e[3],o=s.current.getContext("2d");o.lineWidth=i,o.strokeStyle=l,o.beginPath(),o.moveTo(t.x+u/2,t.y),o.lineTo(r.x-u/2,r.y),o.moveTo(r.x,r.y+u/2),o.lineTo(n.x,n.y-u/2),o.moveTo(n.x-u/2,n.y),o.lineTo(a.x+u/2,a.y),o.moveTo(a.x,a.y-u/2),o.lineTo(t.x,t.y+u/2),o.closePath(),o.stroke()}),[s.current]);return Object(n.useEffect)((function(){if(t&&s.current){p();var e=m();h(e)}}),[t,s.current]),a.a.createElement("canvas",{ref:s,style:{position:"absolute",zIndex:5},width:r.width,height:r.height})};O.propTypes={previewDims:g.a.shape({ratio:g.a.number,width:g.a.number,height:g.a.number}),cropPoints:g.a.shape({"left-top":g.a.shape({x:g.a.number,y:g.a.number}).isRequired,"right-top":g.a.shape({x:g.a.number,y:g.a.number}).isRequired,"right-bottom":g.a.shape({x:g.a.number,y:g.a.number}).isRequired,"left-bottom":g.a.shape({x:g.a.number,y:g.a.number}).isRequired}),lineColor:g.a.string,lineWidth:g.a.number,pointSize:g.a.number};var j,P=function(e){return{width:e.width,height:e.height}},S={width:0,height:0},T=function(e){var t,r,o,i,c,l,u=e.image,s=e.onDragStop,p=e.onChange,m=e.cropperRef,h=e.pointSize,d=void 0===h?30:h,f=e.lineWidth,b=e.pointBgColor,g=e.pointBorder,y=e.lineColor,E=e.maxWidth,x=e.maxHeight,C=Object(v.b)(),T=C.loaded,k=C.cv,A=Object(n.useRef)(),B=Object(n.useRef)(),D=Object(n.useRef)(),I=Object(n.useState)(),_=I[0],z=I[1],M=Object(n.useState)(),H=M[0],N=M[1],q=Object(n.useState)(!1),L=q[0],F=q[1],W=Object(n.useState)("crop"),G=W[0],Y=W[1];Object(n.useImperativeHandle)(m,(function(){return{backToCrop:function(){Y("crop")},done:function(e){void 0===e&&(e={});try{return Promise.resolve(new Promise((function(t){F(!0),function(e,t,r,n,a){var o,i,c=e.imread(t),l=r["right-bottom"],u=r["left-bottom"],s=r["right-top"],p=r["left-top"],m=[p,s,l,u].map((function(e){return[e.x/n,e.y/n]})),h=Math.max(l.x-u.x,s.x-p.x)/n,d=Math.max(u.y-p.y,l.y-s.y)/n,f=[[0,0],[h-1,0],[h-1,d-1],[0,d-1]],v=e.matFromArray(4,1,e.CV_32FC2,(o=[]).concat.apply(o,m)),b=e.matFromArray(4,1,e.CV_32FC2,(i=[]).concat.apply(i,f)),g=e.getPerspectiveTransform(v,b),y=new e.Size(h,d);e.warpPerspective(c,c,g,y,e.INTER_LINEAR,e.BORDER_CONSTANT,new e.Scalar),e.imshow(t,c),c.delete(),v.delete(),b.delete(),g.delete(),a()}(k,A.current,H,j,U),function(e,t,r){try{var n=w({blur:!1,th:!0,thMode:e.ADAPTIVE_THRESH_MEAN_C,thMeanCorrection:15,thBlockSize:25,thMax:255,grayScale:!0},r),a=e.imread(t);if(n.grayScale&&e.cvtColor(a,a,e.COLOR_RGBA2GRAY,0),n.blur){var o=new e.Size(5,5);e.GaussianBlur(a,a,o,0,0,e.BORDER_DEFAULT)}n.th&&(n.grayScale?e.adaptiveThreshold(a,a,n.thMax,n.thMode,e.THRESH_BINARY,n.thBlockSize,n.thMeanCorrection):(a.convertTo(a,-1,1,60),e.threshold(a,a,170,255,e.THRESH_BINARY))),e.imshow(t,a),Promise.resolve()}catch(i){return Promise.reject(i)}}(k,A.current,e.filterCvParams),e.preview&&Y("preview"),A.current.toBlob((function(e){e.name=u.name,t(e),F(!1)}),u.type)})))}catch(t){return Promise.reject(t)}}}})),Object(n.useEffect)((function(){"preview"===G&&V()}),[G]);var U=function(){var e=function(e,t,r,n){var a=e/t,o=r||window.innerWidth,i=n||window.innerHeight,c={width:o,height:Math.round(o/a),ratio:a};return c.height>i&&(c.height=i,c.width=Math.round(i*a)),c}(A.current.width,A.current.height,E,x);z(e),B.current.width=e.width,B.current.height=e.height,j=e.width/A.current.width},V=function(e){var t=e||k.imread(A.current),r=new k.Mat,n=new k.Size(0,0);k.resize(t,r,n,j,j,k.INTER_AREA),k.imshow(B.current,r),t.delete(),r.delete()},J=function(){D.current.getContext("2d").clearRect(0,0,D.current.width,D.current.height)};Object(n.useEffect)((function(){p&&p(w({},H,{loading:L}))}),[H,L]),Object(n.useEffect)((function(){u&&B.current&&T&&"crop"===G?function(){try{return Promise.resolve((e=u,e instanceof File?new Promise((function(t,r){var n=new FileReader;n.onload=function(e){t(n.result)},n.onerror=function(e){r(e)},n.readAsDataURL(e)})):"string"===typeof e?Promise.resolve(e):void 0)).then((function(e){return Promise.resolve(function(e){return new Promise((function(t,r){var n=document.createElement("img");n.onload=function(){try{return A.current=document.createElement("canvas"),A.current.width=n.width,A.current.height=n.height,A.current.getContext("2d").drawImage(n,0,0),S.width=A.current.width,S.height=A.current.height,U(),t(),Promise.resolve()}catch(e){return Promise.reject(e)}},n.src=e}))}(e)).then((function(){V(),function(){var e=k.imread(A.current),t=new k.Size(5,5);k.cvtColor(e,e,k.COLOR_RGBA2GRAY,0),k.GaussianBlur(e,e,t,0,0,k.BORDER_DEFAULT),k.Canny(e,e,75,200),k.threshold(e,e,120,200,k.THRESH_BINARY);var r=new k.MatVector,n=new k.Mat;k.findContours(e,r,n,k.RETR_CCOMP,k.CHAIN_APPROX_SIMPLE);var a=k.boundingRect(e);e.delete(),n.delete(),r.delete(),Object.keys(a).forEach((function(e){a[e]=a[e]*j}));var o={"left-top":{x:a.x,y:a.y},"right-top":{x:a.x+a.width,y:a.y},"right-bottom":{x:a.x+a.width,y:a.y+a.height},"left-bottom":{x:a.x,y:a.y+a.height}};N(o)}(),F(!1)}))}))}catch(t){return Promise.reject(t)}var e}():F(!0)}),[u,B.current,T,G]);var X=Object(n.useCallback)((function(e,t){var r=e.x,n=e.y,a=D.current.getContext("2d");J(),a.drawImage(B.current,r-(d-10),n-(d-10),d+5,d+5,r+10,n-90,d+20,d+20),N((function(e){var a;return w({},e,((a={})[t]={x:r,y:n},a))}))}),[]),K=Object(n.useCallback)((function(e,t,r){var n,a=e.x,o=e.y;(J(),N((function(e){var r;return w({},e,((r={})[t]={x:a,y:o},r))})),s)&&s(w({},r,((n={})[t]={x:a,y:o},n)))}),[]);return a.a.createElement("div",{style:w({position:"relative"},_&&P(_))},_&&"crop"===G&&H&&a.a.createElement(n.Fragment,null,a.a.createElement(R,{pointSize:d,pointBgColor:b,pointBorder:g,cropPoints:H,previewDims:_,onDrag:X,onStop:K,bounds:{left:(null===B||void 0===B||null===(t=B.current)||void 0===t?void 0:t.offsetLeft)-d/2,top:(null===B||void 0===B||null===(r=B.current)||void 0===r?void 0:r.offsetTop)-d/2,right:(null===B||void 0===B||null===(o=B.current)||void 0===o?void 0:o.offsetLeft)-d/2+(null===B||void 0===B||null===(i=B.current)||void 0===i?void 0:i.offsetWidth),bottom:(null===B||void 0===B||null===(c=B.current)||void 0===c?void 0:c.offsetTop)-d/2+(null===B||void 0===B||null===(l=B.current)||void 0===l?void 0:l.offsetHeight)}}),a.a.createElement(O,{previewDims:_,cropPoints:H,lineWidth:f,lineColor:y,pointSize:d}),a.a.createElement("canvas",{style:{position:"absolute",zIndex:5,pointerEvents:"none"},width:_.width,height:_.height,ref:D})),a.a.createElement("canvas",{style:{zIndex:5,pointerEvents:"none"},ref:B}))};T.propTypes={image:g.a.object.isRequired,onDragStop:g.a.func,onChange:g.a.func,cropperRef:g.a.shape({current:g.a.shape({done:g.a.func.isRequired,backToCrop:g.a.func.isRequired})}),pointSize:g.a.number,lineWidth:g.a.number,pointBgColor:g.a.string,pointBorder:g.a.string,lineColor:g.a.string};var k=a.a.forwardRef((function(e,t){return e.image?a.a.createElement(v.a,{openCvPath:e.openCvPath},a.a.createElement(T,w({},e,{cropperRef:t}))):null}));k.propTypes={openCvPath:g.a.string};var A=k,B=(r(150),r(277)),D=r(278),I=r(87),_=r.n(I),z=function(){return a.a.createElement("div",{className:"site-page-header"},a.a.createElement(B.a,{ghost:!1,title:"react-perspective-cropper"},a.a.createElement(D.b,{size:"small",column:2},a.a.createElement(D.b.Item,{label:"Package"},a.a.createElement("a",{href:"https://www.npmjs.com/package/react-perspective-cropper"},a.a.createElement("img",{alt:"npm",src:"https://img.shields.io/npm/v/react-perspective-cropper.svg"})),a.a.createElement("a",{href:"https://standardjs.com"},a.a.createElement("img",{alt:"standardjs",src:"https://img.shields.io/badge/code_style-standard-brightgreen.svg"}))),a.a.createElement(D.b.Item,{label:"Description"},a.a.createElement(_.a,null,"React component performing border detection, perspective correction and simple image filters over a provided image \ud83d\udcf2 \ud83d\udcf8")),a.a.createElement(D.b.Item,{label:"Created by"},"Giacomo Cerquone from",a.a.createElement("span",{"aria-label":"italy flag",role:"img",style:{margin:"0 10px"}},"\ud83c\uddee\ud83c\uddf9"),"with"," ",a.a.createElement("span",{"aria-label":"heart",role:"img",style:{margin:"0 10px"}},"\u2764\ufe0f")),a.a.createElement(D.b.Item,{label:"Info"},a.a.createElement(_.a,null,"Make sure to only use HiRes images!",a.a.createElement("br",null),a.a.createElement("b",null,a.a.createElement("a",{rel:"noreferrer",target:"_blank",href:"https://github.com/giacomocerquone/react-perspective-cropper/blob/master/gifs/example-img.jpg?raw=true"},"You could use this image for example.")))))))},M=p.a.Dragger,H=function(){var e=Object(n.useState)(),t=Object(s.a)(e,2),r=t[0],o=t[1],i=Object(n.useState)(),c=Object(s.a)(i,2),p=c[0],v=c[1],b=Object(n.useRef)(),g=Object(n.useCallback)((function(e){return o(e)}),[]),y=Object(n.useCallback)((function(e){return o(e)}),[]),E=function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("CropState",r),e.prev=1,e.next=4,b.current.done({preview:!0,filterCvParams:{thMeanCorrection:13,thMode:window.cv.ADAPTIVE_THRESH_GAUSSIAN_C}});case 4:t=e.sent,console.log("Cropped and filtered image",t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log("error",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),w={name:"file",multiple:!1,onChange:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.fileList&&t.fileList.length>0&&v(t.fileList[0].originFileObj);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};return a.a.createElement("div",{className:"root-container"},a.a.createElement(z,null),a.a.createElement("div",{className:"content-container"},r&&a.a.createElement("div",{className:"buttons-container"},a.a.createElement(m.a,{onClick:E,icon:a.a.createElement(d.a,null)},"Done"),a.a.createElement(m.a,{onClick:function(){b.current.backToCrop()}},"Back"),a.a.createElement(m.a,{onClick:function(){v(void 0),o()}},"Reset")),a.a.createElement(A,{openCvPath:"./opencv/opencv.js",ref:b,image:p,onChange:y,onDragStop:g,maxWidth:window.innerWidth-10}),(null===r||void 0===r?void 0:r.loading)&&a.a.createElement(h.a,null),!p&&a.a.createElement(M,w,a.a.createElement("p",null,a.a.createElement(f.a,null)),a.a.createElement("p",null,"Upload"))))};i.a.render(a.a.createElement(H,null),document.getElementById("root"))}},[[137,1,2]]]);
//# sourceMappingURL=main.2f17f136.chunk.js.map